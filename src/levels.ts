// levels.ts

enum Tile {
    NONE = 0,
    FLOOR1 = 2,
    FLOOR2 = 3,
    LADDER = 4,
    CHANGER = 5,
    DOOR = 6,
    EXIT = 7,
    SWITCHOFF = 8,
    SWITCHON = 9,
    MIRROR = 10,

    SPECIAL = 20,
    
    PLAYER = 20,
    CHANGERENT = 21,
    DOORENT = 22,
    EXITENT = 23,
    SWITCHENT = 24,
    
    SHAPE1 = 30,
    SHAPE2 = 31,
    SHAPE3 = 32,
}

interface CharMap {
    [index: string]: number;
}
const TILEMAP = {
    '#': Tile.FLOOR1,
    'H': Tile.LADDER,
    'M': Tile.MIRROR,

    'P': Tile.PLAYER,
    'c': Tile.CHANGERENT,
    'd': Tile.DOORENT,
    'e': Tile.EXITENT,
    'i': Tile.SWITCHENT,

    'A': Tile.SHAPE1,
    'B': Tile.SHAPE2,
    'C': Tile.SHAPE3,
} as CharMap;

class Level {
    
    map: [string];
    text: string;
    following: boolean;
    special: number;
    
    constructor(map:[string], text:string,
		following=false, special=0) {
	this.map = map;
	this.text = text;
	this.following = following;
	this.special = special;
    }

    getArray() {
	let a = [] as [[number]];
	for (let i = 0; i < this.map.length; i++) {
	    let src = this.map[i];
	    let dst = [] as [number]
	    for (let j = 0; j < src.length; j++) {
		let c = TILEMAP[src[j]];
		if (c === undefined) {
		    c = Tile.NONE;
		}
		if (c == 0 || c == 2) {
		    c += (i*j+i+j) % 2;
		}
		dst.push(c);
	    }
	    a.push(dst)
	}
	return a;
    }
}

const LEVELS = [
    new Level([			// LEVEL 0
	//1234567890123456789
	'...................e',
	'..............##H###',
	'.....i.........#H...',
	'..H####..##....dH...',
	'..H...........######',
	'...........#........',
	'....................',
	'.#######............',
	'.........###...####H',
	'...................H',
	'...................H',
	'.........H###..##H##',
	'.....#...H..#....H..',
	'..P.###..H..#....H..',
	'####################',
    ],
	      "I HAVE NO MEMORY.\n"+
	      "I DON'T KNOW WHO I AM.\n"
	     ),
    
    new Level([			// LEVEL 1
	//12345678901234567890123456789
	'..............................',
	'....................C......e..',
	'###############H##############',
	'...............H..............',
	'.............c.H..............',
	'#####H###...##################',
	'.....H........................',
	'.....H..c...B.................',
	'###########################H##',
	'.......................#...H..',
	'..............A..i.....d...H..',
	'####H###############H#########',
	'....H...............H.........',
	'.P..H..c............H.........',
	'##############################',
    ],
	      "OH? THERE IS SOMEONE\n"+
	      "OVER THERE.\n"
	     ),

    new Level([			// LEVEL 2
	//1234567890123456789
	'....................',
	'......P.............',
	'############..##H###',
	'................H...',
	'................H...',
	'......i...c.....H...',
	'.....###############',
	'.....#..............',
	'.....#..............',
	'.A...d...B..B..B....',
	'#################H##',
	'..............#..H..',
	'.......c......d..H.i',
	'##..######..########',
	'....................',
	'B...................',
	'##H###.........#C...',
	'..H.......#..C###C.e.',
	'####################',
    ],
	      "PHEW, THAT WAS CLOSE.\n"+
	      "NOW, HOW TO GET THROUGH THOSE GUYS?\n"
	     ),
    
    new Level([			// LEVEL 3
	//1234567890123456789
	'...................e',
	'.B..B..B..B..B..B..H',
	'######H#############',
	'......H.............',
	'.....###...c........',
	'.........######.....',
	'................##H#',
	'..................H.',
	'....#####H###.#...H.',
	'....#....H......####',
	'i...d.C..H..C.......',
	'##H#################',
	'..H.................',
	'#######.....#####...',
	'.......####.......#.',
	'.................#..',
	'.........H####..#...',
	'.........H.....#....',
	'......####..........',
	'..A #.A..A..A...A...',
	'##############H#####',
	'.P..c.........H.....',
	'####################',
    ],
	      "THEIR BATTLES ARE FIERCE.\n"+
	      "I DON'T WANT TO FIGHT THEM.\n"+
	      "BUT I HAVE NO OTHER CHOICE.\n",
	      true
	     ),
    
    new Level([			// LEVEL 4 (INTERMISSION)
	//1234567890123456789
	'...#.....#........P.',
	'...#.....#..#####H##',
	'...d.....#i......H..',
	'.####....###.....H..',
	'.#....#....#..######',
	'.####...#..# .......',
	'....#...#..#####H###',
	'###.#.H##.......H...',
	'....#.H.########H###',
	'....#.H...#.....H...',
	'....##H...#i....H...',
	'....#.H..###..####H#',
	'....#.H..#........H.',
	'.e..#.H..d..#.....H.',
	'####################',
    ],
	      "WHAT MAKES THEM HATE EACH OTHER?\n"+
	      "TO ME, THEY DON'T SEEM VERY DIFFERENT.\n"+
	      "DO LOOKS MATTER THAT MUCH TO THEM?\n"
	     ),
    
    new Level([			// LEVEL 5
	//1234567890123456789
	'......########......',
	'......########......',
	'......########......',
	'......########......',
	'......########......',
	'......########......',
	'......########......',
	'......########......',
	'....................',
	'....................',
	'H..##############..H',
	'HAAAAA.BBPBBB.CCCCCH',
	'##................##',
	'####............####',
	'####################',
    ],
	      "WHAT THE...\n",
	      true,
	      1
	     ),

    new Level([			// LEVEL 6 (ENDING)
	//1234567890123456789
	'....................',
	'.........P..........',
	'....................',
	'....................',
	'....................',
	'....................',
	'....................',
	'....................',
	'....................',
	'..........M.........',
	'...######H######....',
	'.........H..........',
	'.........H..........',
	'.........H..........',
	'####################',
    ],
	      null,
	      false,
	      3
	     ),
];
